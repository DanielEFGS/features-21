<section class="page">
  @if (lab(); as selectedLab) {
    <app-lab-hero [lab]="selectedLab"></app-lab-hero>

    <div class="lab-body">
      <app-lab-toc [sections]="tocSections()"></app-lab-toc>

      <div class="lab-content">
        @for (section of sections(); track section.id) {
          <app-lab-section [section]="section"></app-lab-section>
        }

        @if (selectedLab.id === 'signals') {
          <app-lab-code-demo
            sectionId="demo"
            demoId="signals-quick-compare"
            title="Signals quick compare demo"
            i18n-title="@@labSignalsDemoTitle"
            description="Pick up to three Pokemon and see derived state update instantly."
            i18n-description="@@labSignalsDemoDescription"
            [tabs]="signalsDemoTabs"
          >
            <app-signals-demo labDemoPreview></app-signals-demo>
          </app-lab-code-demo>
        }

        @if (selectedLab.id === 'httpresource') {
          <app-lab-code-demo
            sectionId="demo"
            demoId="httpresource-lookup"
            title="httpResource lookup demo"
            i18n-title="@@labHttpResourceDemoTitle"
            description="Fetch a Pokemon by name and track loading and error states."
            i18n-description="@@labHttpResourceDemoDescription"
            [tabs]="httpResourceDemoTabs"
          >
            <app-httpresource-demo labDemoPreview></app-httpresource-demo>
          </app-lab-code-demo>
        }

        @if (selectedLab.id === 'rxjs-interop') {
          <app-lab-code-demo
            sectionId="demo"
            demoId="rxjs-interop-helper"
            title="RxJS interop demo"
            i18n-title="@@labRxjsInteropDemoTitle"
            description="Debounce input into a signal, emit an output, and observe it as a stream."
            i18n-description="@@labRxjsInteropDemoDescription"
            [tabs]="rxjsInteropDemoTabs"
          >
            <app-rxjs-interop-demo labDemoPreview></app-rxjs-interop-demo>
          </app-lab-code-demo>
        }

        @if (selectedLab.id === 'routing') {
          <app-lab-code-demo
            sectionId="demo"
            demoId="routing-query-params"
            title="Routing demo"
            i18n-title="@@labRoutingDemoTitle"
            description="Swap panels by updating query params without leaving the lab."
            i18n-description="@@labRoutingDemoDescription"
            [tabs]="routingDemoTabs"
          >
            <app-routing-demo labDemoPreview></app-routing-demo>
          </app-lab-code-demo>
        }

        @if (selectedLab.id === 'di') {
          <app-lab-code-demo
            sectionId="demo"
            demoId="di-notes"
            title="DI demo"
            i18n-title="@@labDiDemoTitle"
            description="Share notes through a service and compare provider scope."
            i18n-description="@@labDiDemoDescription"
            [tabs]="diDemoTabs"
          >
            <app-di-demo labDemoPreview></app-di-demo>
          </app-lab-code-demo>
        }

        @if (selectedLab.id === 'forms') {
          <app-lab-code-demo
            sectionId="demo"
            demoId="forms-trainer-contact"
            title="Signal Forms demo"
            i18n-title="@@labFormsDemoTitle"
            description="Build a trainer contact form with schema validation and field state feedback."
            i18n-description="@@labFormsDemoDescription"
            [tabs]="formsDemoTabs"
          >
            <app-forms-demo labDemoPreview></app-forms-demo>
          </app-lab-code-demo>
        }

        @if (selectedLab.id === 'animations') {
          <app-lab-code-demo
            sectionId="demo"
            demoId="animations-toast-queue"
            title="Animations demo"
            i18n-title="@@labAnimationsDemoTitle"
            description="Enter/leave motion with a staggered toast list."
            i18n-description="@@labAnimationsDemoDescription"
            [tabs]="animationsDemoTabs"
          >
            <app-animations-demo labDemoPreview></app-animations-demo>
          </app-lab-code-demo>
        }

        @if (selectedLab.id === 'style-guide') {
          <app-lab-code-demo
            sectionId="demo"
            demoId="style-guide-naming"
            title="Style guide demo"
            i18n-title="@@labStyleGuideDemoTitle"
            description="Validate selectors, class names, and file bases."
            i18n-description="@@labStyleGuideDemoDescription"
            [tabs]="styleGuideDemoTabs"
          >
            <app-style-guide-demo labDemoPreview></app-style-guide-demo>
          </app-lab-code-demo>
        }

        @if (selectedLab.id === 'tailwind') {
          <app-lab-code-demo
            sectionId="demo"
            demoId="tailwind-utilities"
            title="Tailwind demo"
            i18n-title="@@labTailwindDemoTitle"
            description="Toggle common utilities and see the resulting class string."
            i18n-description="@@labTailwindDemoDescription"
            [tabs]="tailwindDemoTabs"
          >
            <app-tailwind-demo labDemoPreview></app-tailwind-demo>
          </app-lab-code-demo>
        }

        @if (selectedLab.id === 'a11y-aria') {
          <app-lab-code-demo
            sectionId="demo"
            demoId="a11y-aria-panel"
            title="A11y & Aria demo"
            i18n-title="@@labA11yDemoTitle"
            description="Labeled fields, helper text, and a live region for results."
            i18n-description="@@labA11yDemoDescription"
            [tabs]="a11yAriaDemoTabs"
          >
            <app-a11y-aria-demo labDemoPreview></app-a11y-aria-demo>
          </app-lab-code-demo>
        }

        @if (selectedLab.id === 'pwa') {
          <app-lab-code-demo
            sectionId="demo"
            demoId="pwa-readiness"
            title="PWA checklist demo"
            i18n-title="@@labPwaDemoTitle"
            description="App-shell readiness with no API caching and a clear update prompt."
            i18n-description="@@labPwaDemoDescription"
            [tabs]="pwaDemoTabs"
          >
            <app-pwa-demo labDemoPreview></app-pwa-demo>
          </app-lab-code-demo>
        }

        @if (selectedLab.id === 'testing') {
          <app-lab-code-demo
            sectionId="demo"
            demoId="testing-ssr-safe"
            title="Testing checklist demo"
            i18n-title="@@labTestingDemoTitle"
            description="SSR-safe specs with HTTP mocks and router harness."
            i18n-description="@@labTestingDemoDescription"
            [tabs]="testingDemoTabs"
          >
            <app-testing-demo labDemoPreview></app-testing-demo>
          </app-lab-code-demo>
        }

        @if (selectedLab.id === 'performance') {
          <app-lab-code-demo
            sectionId="demo"
            demoId="performance-guardrails"
            title="Performance checklist demo"
            i18n-title="@@labPerformanceDemoTitle"
            description="Budgets, defer plan, and asset/network guardrails."
            i18n-description="@@labPerformanceDemoDescription"
            [tabs]="performanceDemoTabs"
          >
            <app-performance-demo labDemoPreview></app-performance-demo>
          </app-lab-code-demo>
        }

        @if (selectedLab.id === 'custom-build') {
          <app-lab-code-demo
            sectionId="demo"
            demoId="custom-build-pipeline"
            title="Custom build checklist demo"
            i18n-title="@@labCustomBuildDemoTitle"
            description="Goals, pipeline steps, caching, SSR checks, rollback."
            i18n-description="@@labCustomBuildDemoDescription"
            [tabs]="customBuildDemoTabs"
          >
            <app-custom-build-demo labDemoPreview></app-custom-build-demo>
          </app-lab-code-demo>
        }

        @if (selectedLab.id === 'cdk') {
          <app-lab-code-demo
            sectionId="demo"
            demoId="cdk-checklist"
            title="CDK checklist demo"
            i18n-title="@@labCdkDemoTitle"
            description="Overlay, focus, portal, and focus-restore steps."
            i18n-description="@@labCdkDemoDescription"
            [tabs]="cdkDemoTabs"
          >
            <app-cdk-demo labDemoPreview></app-cdk-demo>
          </app-lab-code-demo>
        }

        <app-lab-exercise sectionId="exercise" [exercise]="selectedLab.exercise"></app-lab-exercise>
        <app-lab-references sectionId="references" [references]="selectedLab.references"></app-lab-references>
      </div>
    </div>
  } @else {
    <header class="page-header" appTextureLayer>
      <div>
        <p class="eyebrow">Lab</p>
        <h1>Content pending</h1>
      </div>
    </header>

    <div class="placeholder" appTextureLayer>
      @if (catalogItem(); as item) {
        <p class="placeholder-title">{{ item.title }}</p>
        <p>{{ item.summary }}</p>
      } @else {
        <p>This lab is not available yet.</p>
      }
    </div>
  }
</section>
